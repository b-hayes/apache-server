<VirtualHost *>
    ServerName localhost
    DocumentRoot "/var/www"

    <Directory "/var/www">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    RewriteEngine On

    # Directs any domain to a matching folder in the DocumentRoot eg:
    #   www.domain.com and domain.com = DocumentRoot/domain.com/
    #   sub-domain.domain.com = DocumentRoot/sub-domain.domain.com/
    #   really.long.domain.edu.gov.au = DocumentRoot/really.long.domain.edu.gov.au/
    # But only if the destination folder exists.
    RewriteCond %{HTTP_HOST} ^(www\.)?([^.]+(\.[^.]+)+)$ [NC]
    RewriteCond %{DOCUMENT_ROOT}/%2 -d
    RewriteRule ^(.*)$ /%2/$1 [L]

    # Catch-all unknown domains and return a 404 response, using custom 404 pages if they exist.
    RewriteCond %{DOCUMENT_ROOT}/404.php -f
    RewriteRule ^ /404.php [L]

    RewriteCond %{DOCUMENT_ROOT}/404.html -f
    RewriteRule ^ /404.html [L]

    RewriteRule ^ - [R=404,L]

</VirtualHost>
